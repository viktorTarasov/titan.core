.******************************************************************************
.* Copyright (c) 2000-2018 Ericsson Telecom AB
.* All rights reserved. This program and the accompanying materials
.* are made available under the terms of the Eclipse Public License v2.0
.* which accompanies this distribution, and is available at
.* https://www.eclipse.org/org/documents/epl-2.0/EPL-2.0.html
.*
.* Contributors:
.*   Balasko, Jeno
.*   Beres, Szabolcs
.*   Delic, Adam
.*   Kovacs, Ferenc
.*   Szabados, Kristof
.*
.******************************************************************************/
:text.
:lang eng.
.*
:docname.Test Description
:docno.8/152 91-CRL 113 200/5 Uen
:rev.C
:date.2015-04-27
.*
:prep.ETH/XZR Kristof Szabados (+36 1 437 7256)
:appr.ETH/XZ (Roland Gecse)
:checked.ETHBAAT
.*
:title.Test Description - OER coder
:contents level=3.
.*---------------------------------------------------------------------*
:h1.PREREQUISITES AND PREPARATIONS
.*---------------------------------------------------------------------*
.*---------------------------------------------------------------------*
:h2.Scope of the Test Object
.*---------------------------------------------------------------------*
:xmp tab=1 nokeep.

This TD contains unified test cases related to TTCN3 Executor's OER coder function.

The target of these test cases are the basic data types from specification
'ISO/IEC 8825-7:2015 -- Information technology – ASN.1 encoding rules:
Specification of Octet Encoding Rules'

The target data types are used in the following technical specification:
 'ETSI TS 103 097 V1.3.1 (2017-10)'
Intelligent Transport Systems (ITS); Security;
Security header and certificate formats and certificate formats 

 'IEEE Std 1609.2-2016 IEEE Standard'
Wireless Access in Vehicular Environments—Security Services for
Applications and Management Messages

:exmp.

:p.:us.Revision Information:eus.

:xmp nokeep.
:us.History:eus.

REV   DATE         PREPARED   CHANGE
===   ==========   ========   ======
A     2003-10-31   ETHEKR     New document
B     2007-03-06   EDMDELI    Implicit message encoding
C     2007-03-21   EJNOSZA    Bugfix in a testcase for implicit msg. enc.
D     2008-10-01   EFERKOV    Big integers
E     2010-01-18   EKRISZA    Updated for TITAN R8C
F     2011-06-18   EKRISZA    Added tests for errors
A     2011-12-12   EKRISZA     Updated for release
PB1   2011-01-30   ETHBAAT    Editorial changes

:exmp.


.*---------------------------------------------------------------------*
:h2.Test Tools
.*---------------------------------------------------------------------*
:p.:us.Software Tools:eus.
:xmp tab=2 nokeep.

	SAtester

:exmp.
:np.
.*---------------------------------------------------------------------*
:h1.REQUIREMENT-BASED TESTS
.*---------------------------------------------------------------------*
.*---------------------------------------------------------------------*
:h2.Testing OER encoding of the basic types
.*---------------------------------------------------------------------*
.*---------------------------------------------------------------------*
:h3. OER encoding
.*---------------------------------------------------------------------*
:xmp tab=0.

<TC - OER encoding (unified tests)>

<STATIC:ASN>

TempA

DEFINITIONS ::=

BEGIN

IMPORTS
  Certificate, Ieee1609Dot2Data FROM IEEE1609dot2 {
    iso(1) identified-organization(3) ieee(111)
    standards-association-numbered-series-standards(2) wave-stds(1609)
    dot2(2) base(1) schema(1) major-version-2(2)
  }

  EtsiTs102941Data, EtsiTs102941DataContent FROM EtsiTs102941MessagesCa {
    itu-t(0) identified-organization(4) etsi(0)
    itsDomain(5) wg5(5) ts(102941) messagesCa(0) version1(1)
  };

  TestCertificate ::= Certificate

END

<STATIC>


type component Test_CT {}

<TTCN_TC:PURE_EXEC>

import from IEEE1609dot2 all;
import from EtsiTs103097Module all;
import from EtsiTs102941MessagesCa all;


external function enc_EtsiTs103097Data(in EtsiTs103097Data pdu) return octetstring with { extension "prototype(convert) encode(OER)" }
external function dec_EtsiTs103097Data(in octetstring stream) return EtsiTs103097Data with { extension "prototype(convert) decode(OER)" }

external function enc_Ieee1609Dot2Data(in Ieee1609Dot2Data pdu) return octetstring with { extension "prototype(convert) encode(OER)" }
external function dec_Ieee1609Dot2Data(in octetstring stream) return Ieee1609Dot2Data with { extension "prototype(convert) decode(OER)" }

external function enc_EtsiTs102941Data(in EtsiTs102941Data pdu) return octetstring with { extension "prototype(convert) encode(OER)" }
external function dec_EtsiTs102941Data(in octetstring stream) return EtsiTs102941Data with { extension "prototype(convert) decode(OER)" }

external function dec_EtsiTs103097DataEncryptedBis(in octetstring stream) return EtsiTs103097Data_Encrypted_My with { extension "prototype(convert) decode(OER)" }

//*********************************************
// TESTCASES
//*********************************************

testcase tc_Ieee1609Dot2Data() runs on Test_CT {
   const octetstring encoded := '0381004003808204E101860001011CB8E303FF030104808180800300803A0407A419D556AA3981195465737420425349205632582050696C6F7420504B4920454100000000001C1EF357843360000102800203E781030201508002026F810302010E01012080010980012482080301FFFC03FF0003800125820A0401FFFFFF04FF000000800203E782060201A002FF5F80018982060201E002FF1F80018A82060201C002FF3F80018B820E0601940000FFF806FF000000000780018C820A0401FFFFE004FF00001F80018D8204010001FF8002026F82060201C002FF3F400081835A67468F00DE443A783CC479D3C0794B2E54AE850AF386105731DE370BD9E4D58081832B69AE900EF44DCB9E394F26DF8E4AEA2FB346F16BED178607B1A5E5AD91503081805B826F36984B11D79166500462870D126CA713EC3894B9757FBABEA5408AF59806DA6C3572C09FAE35A931C81233609A6EAC5F3169380982A05DBECA1E306A5624687474703A2F2F646F636B6572763278746573746273695F65615F313A383038302F656128687474703A2F2F746573742E6273692E7632782D70696C6F742E657363727970742E636F6D2F65618082800300803A0407A419D556AA3981195465737420425349205632582050696C6F7420504B4920414100000000001C1EF4488422380001018002026F810302013201010080010780012482080301FFFC03FF0003800125820A0401FFFFFF04FF00000080018982060201E002FF1F80018A82060201C002FF3F80018B820E0601940000FFF806FF000000000780018C820A0401FFFFE004FF00001F80018D8204010001FF008083A6E5665A4B87A61027C7D15E4599285E76E5017BEA0271648052FEF1EC6CCB6B80808374616C722C3AA2ADEDB6DDCDB3731EAE4AF01E010F801CDC8D2DD437167D46C78180225E37E8D6538E032543EF1475C84BCDB671E7A96294D4BC0DDF6445162546692D91AB4F40D23EB0218E87219A309B8492822A17E5997187840E2B4F400149AD28687474703A2F2F746573742E6273692E7632782D70696C6F742E657363727970742E636F6D2F6161808328687474703A2F2F746573742E6273692E7632782D70696C6F742E657363727970742E636F6D2F646301013A0407A419D556AA808180800300803A0407A419D556AA39811C54657374204469536F5761205632582050696C6F7420504B4920454100000000001C42390B843348000102800203E781030201508002026F810302010E01012080010980012482080301FFFC03FF0003800125820A0401FFFFFF04FF000000800203E782060201A002FF5F80018982060201E002FF1F80018A82060201C002FF3F80018B820E0601940000FFF806FF000000000780018C820A0401FFFFE004FF00001F80018D8204010001FF8002026F82060201C002FF3F400081825944ABCB705BDD9EB433A8A459CD669EC33C8C50F3EFAB0EE12224C4413D771A808182043526B9136BC3A6E056A5182CF1F333F6C024EF169CEDA9DE4565F0E15E2A2381808B6B59F4BFE67818A4DD446BD1832E5946D760E8035DA43AC5D6A6F7479D183B8DD9A62BEDFBDD72E0CC218F08F8DEE939C96DA6B773B43C6CF55A8A731515DA2B687474703A2F2F746573742E6469736F77612E7632782D70696C6F742E657363727970742E636F6D2F65612B687474703A2F2F746573742E6469736F77612E7632782D70696C6F742E657363727970742E636F6D2F6561400202700001AF31A83591E0810101800300810038811B5465737420425349205632582050696C6F7420504B4920526F6F7400000000001C1EE2A08444880001028002027081030201388002026E810201010101A080010980012482080301FFFC03FF0003800125820A0401FFFFFF04FF000000800203E782060201F002FF0F80018982060201E002FF1F80018A82060201C002FF3F80018B820E0601940000FFF806FF000000000780018C820A0401FFFFE004FF00001F80018D8204010001FF8002026F82060201FE02FF010102C0808183A08E8B5F8755B9515B7CC3342069F20D9E56DD9F2DB1274A5E091ECD760A232E81809B15FA3322C5FE32762CB174D92DB7B74B2E420F0E9D97986C0C647EF48EB9DB3EB9D0ECDC1FE362FB998FC21AAA407E8BAA188F2D7A0087EB355D6D42C8056281806F838B13CE2B0E2BBBC3DA05A06B31C22F0D77198C9804CC578ED2F8D0905D84A109828A125790A6590694D35E59419A2CAB48163616DB1A2DFA07728B73B90C'O;

   const octetstring encoded_unsecured_data := '01860001011CB8E303FF030104808180800300803A0407A419D556AA3981195465737420425349205632582050696C6F7420504B4920454100000000001C1EF357843360000102800203E781030201508002026F810302010E01012080010980012482080301FFFC03FF0003800125820A0401FFFFFF04FF000000800203E782060201A002FF5F80018982060201E002FF1F80018A82060201C002FF3F80018B820E0601940000FFF806FF000000000780018C820A0401FFFFE004FF00001F80018D8204010001FF8002026F82060201C002FF3F400081835A67468F00DE443A783CC479D3C0794B2E54AE850AF386105731DE370BD9E4D58081832B69AE900EF44DCB9E394F26DF8E4AEA2FB346F16BED178607B1A5E5AD91503081805B826F36984B11D79166500462870D126CA713EC3894B9757FBABEA5408AF59806DA6C3572C09FAE35A931C81233609A6EAC5F3169380982A05DBECA1E306A5624687474703A2F2F646F636B6572763278746573746273695F65615F313A383038302F656128687474703A2F2F746573742E6273692E7632782D70696C6F742E657363727970742E636F6D2F65618082800300803A0407A419D556AA3981195465737420425349205632582050696C6F7420504B4920414100000000001C1EF4488422380001018002026F810302013201010080010780012482080301FFFC03FF0003800125820A0401FFFFFF04FF00000080018982060201E002FF1F80018A82060201C002FF3F80018B820E0601940000FFF806FF000000000780018C820A0401FFFFE004FF00001F80018D8204010001FF008083A6E5665A4B87A61027C7D15E4599285E76E5017BEA0271648052FEF1EC6CCB6B80808374616C722C3AA2ADEDB6DDCDB3731EAE4AF01E010F801CDC8D2DD437167D46C78180225E37E8D6538E032543EF1475C84BCDB671E7A96294D4BC0DDF6445162546692D91AB4F40D23EB0218E87219A309B8492822A17E5997187840E2B4F400149AD28687474703A2F2F746573742E6273692E7632782D70696C6F742E657363727970742E636F6D2F6161808328687474703A2F2F746573742E6273692E7632782D70696C6F742E657363727970742E636F6D2F646301013A0407A419D556AA808180800300803A0407A419D556AA39811C54657374204469536F5761205632582050696C6F7420504B4920454100000000001C42390B843348000102800203E781030201508002026F810302010E01012080010980012482080301FFFC03FF0003800125820A0401FFFFFF04FF000000800203E782060201A002FF5F80018982060201E002FF1F80018A82060201C002FF3F80018B820E0601940000FFF806FF000000000780018C820A0401FFFFE004FF00001F80018D8204010001FF8002026F82060201C002FF3F400081825944ABCB705BDD9EB433A8A459CD669EC33C8C50F3EFAB0EE12224C4413D771A808182043526B9136BC3A6E056A5182CF1F333F6C024EF169CEDA9DE4565F0E15E2A2381808B6B59F4BFE67818A4DD446BD1832E5946D760E8035DA43AC5D6A6F7479D183B8DD9A62BEDFBDD72E0CC218F08F8DEE939C96DA6B773B43C6CF55A8A731515DA2B687474703A2F2F746573742E6469736F77612E7632782D70696C6F742E657363727970742E636F6D2F65612B687474703A2F2F746573742E6469736F77612E7632782D70696C6F742E657363727970742E636F6D2F6561'O;
 
   const octetstring encoded_our := '03810040038082030A010186000101200D69F5FF00010480818080030080B595727160FF739C7981077465737452434100000000001C1A3B7586000A830101800021000102800122800445673211800123810403267121010200810081008083DC4A13B3E6792F92F7B03DC1F9CDC6DF1D4EFCDD719C8810888AFF12D7343B69808083A1F2DB64E08E68199B2DDBD7F49714AF36BD69CBCB76B8BDBDC5D4389B3334548080ED3B4E871D17AF873ADEF0E5E83EF0F6D3857E02FFA83F1C6707E1D88CE4668B894D50E56F819C36112D55143681DA07EA50220CA728F64D8A7B98673F21EFA015687474703A2F2F6C6F63616C686F73743A3830383015687474703A2F2F6C6F63616C686F73743A38303830808180800300807CB8EE4AE3AE0BAA198102454100000000001C4076F586000A0101000124010200810081008083C35D02BBD21DEA847801ABC811FD238B723DBF81C6044052ED049E91A0F1F02280808380592FEB93BC30825E6345910C8FE4889AAF1A1F4EF0F163BD45FEE3E0BC348E8080C3B95C3F9AC57C5937B255212A73A4C264BF66363DEC7666F8021D01527347734603CBD74E727339684ECEB788A9584A6526A0EC237F73CDC9DDCC4209D9EF3915687474703A2F2F6C6F63616C686F73743A3830383015687474703A2F2F6C6F63616C686F73743A383038308081808003008023C263AE3C8D464F79810674657374454100000000001C1A3B7586000A830101800021000102800122800445673211800123810403267121010200810081008083DC4A13B3E6792F92F7B03DC1F9CDC6DF1D4EFCDD719C8810888AFF12D7343B69808083A1F2DB64E08E68199B2DDBD7F49714AF36BD69CBCB76B8BDBDC5D4389B3334548080A26B6288903DA635839B66324DC73EEC856DA29E7D29BBE0E83A59C278A69F6D1ABC77CE8530C158904E1786F8170DE51F4F5770E079CA087C4B340D73D5E51015687474703A2F2F6C6F63616C686F73743A3830383015687474703A2F2F6C6F63616C686F73743A38303830808315687474703A2F2F6C6F63616C686F73743A3830383001022272F01390DA8DAB7CB8EE4AE3AE0BAAC00202700001B03A404224B8020600802272F01390DA8DAB8080D2700E1EA2330C6A01E87F7D88D303182DC9480080A3A200E711038BF536B927F7BEBA2C59B6C78C805B02477CD1883C43EB647A1BFC6F28D369BEDDBA1616BD'O;

   const octetstring encoded_our_bis := '0381004003808203D9010185000101200D69F5FF0201038080008003008100188106726F6F74434100000000001C4076F586000A01018001248002FFFF010200810081808082B508635B64345D0AC96EA586D58F07ACF83476C0AF8A2B95D1FE9CF341D96AFE80802662D8B62BD76DDA2FF971E0B9DC89314FF0BDCFB5C9449620D284D1F1DD8128E46BB852338118A866150F0FA69D8733F4A77FD6119B94B9917D43AA9022BBC0808480800300810070810774657374544C4D00000000001C1A3B7586000A83010282002101020B0102001600150B01010016820021010101010100010001028001228004456732118001238104032671218080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A16808051F06569167A9EDAFCBA8C87AE167CD3C84D8D5AC98EEFDD842F798998FF3A235A526F5513610563F9F214422DF7F971CB947B00210B0662D5EA946A64AD9DCD800300810070810774657374544C4D00000000001C1A3B7586000A83010282002101020B0102001600150B01010016820021010101010100010001028001228004456732118001238104032671218080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A1680802758B32076D0B239A0B272331A7FC7D5DC8D9FF6FBB6CE27EB06EA2C4367C4C05733316F5179FBDEBDF23B5AE458033B42DCEC5F59D2F1FD29706C71C0A2512B15687474703A2F2F6C6F63616C686F73743A3830383080808080030081007981077465737452434100000000001C1A3B7586000A83010282002101020B0102001600150B010100168200210101010101000100010280012280044567321180012381040326712101020081008100808251434D2BFF68CDF5EB0DF83E33196A2FBCD3A61B6BA188FA760BF7E566569CDB8080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A168080E26927CEADA6536F35208CE62D49AE31DAEA301817695CFE3CCDBBA819AFAAC0D1E774354C365546B69510FE9E5130FD9C9EE16CE19A07BEB9E3B7F7858A025B80030081007981077465737452434100000000001C1A3B7586000A83010282002101020B0102001600150B010100168200210101010101000100010280012280044567321180012381040326712101020081008100808251434D2BFF68CDF5EB0DF83E33196A2FBCD3A61B6BA188FA760BF7E566569CDB8080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A1680809A3AB569C50771A5566B3FDDB2329D9BA45AAFF42D8C7479527064411025D869B18585F724CF4E80F340662D8C4BF6EBD49D2C3F84B9E2AD9EE067F2EFA8C5C3C00202700001B03EF127E840020600810101800300810070810774657374544C4D00000000001C1A3B7586000A83010282002101020B0102001600150B01010016820021010101010100010001028001228004456732118001238104032671218080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A16808051F06569167A9EDAFCBA8C87AE167CD3C84D8D5AC98EEFDD842F798998FF3A235A526F5513610563F9F214422DF7F971CB947B00210B0662D5EA946A64AD9DCD8080E4B07C162E6953CBD2FDEFFA2E66AC7B6831C31B4EB3171947BCCDBD6534E04514EDC5EA06A9A647CC7FCC80B566A77982CB0CED5BDA231975A1A7284E78B355'O;

   const octetstring encoded_unsecured_data_our := '0185000101200D69F5FF0201038080008003008100188106726F6F74434100000000001C4076F586000A01018001248002FFFF010200810081808082B508635B64345D0AC96EA586D58F07ACF83476C0AF8A2B95D1FE9CF341D96AFE80802662D8B62BD76DDA2FF971E0B9DC89314FF0BDCFB5C9449620D284D1F1DD8128E46BB852338118A866150F0FA69D8733F4A77FD6119B94B9917D43AA9022BBC0808480800300810070810774657374544C4D00000000001C1A3B7586000A83010282002101020B0102001600150B01010016820021010101010100010001028001228004456732118001238104032671218080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A16808051F06569167A9EDAFCBA8C87AE167CD3C84D8D5AC98EEFDD842F798998FF3A235A526F5513610563F9F214422DF7F971CB947B00210B0662D5EA946A64AD9DCD800300810070810774657374544C4D00000000001C1A3B7586000A83010282002101020B0102001600150B01010016820021010101010100010001028001228004456732118001238104032671218080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A1680802758B32076D0B239A0B272331A7FC7D5DC8D9FF6FBB6CE27EB06EA2C4367C4C05733316F5179FBDEBDF23B5AE458033B42DCEC5F59D2F1FD29706C71C0A2512B15687474703A2F2F6C6F63616C686F73743A3830383080808080030081007981077465737452434100000000001C1A3B7586000A83010282002101020B0102001600150B010100168200210101010101000100010280012280044567321180012381040326712101020081008100808251434D2BFF68CDF5EB0DF83E33196A2FBCD3A61B6BA188FA760BF7E566569CDB8080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A168080E26927CEADA6536F35208CE62D49AE31DAEA301817695CFE3CCDBBA819AFAAC0D1E774354C365546B69510FE9E5130FD9C9EE16CE19A07BEB9E3B7F7858A025B80030081007981077465737452434100000000001C1A3B7586000A83010282002101020B0102001600150B010100168200210101010101000100010280012280044567321180012381040326712101020081008100808251434D2BFF68CDF5EB0DF83E33196A2FBCD3A61B6BA188FA760BF7E566569CDB8080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A1680809A3AB569C50771A5566B3FDDB2329D9BA45AAFF42D8C7479527064411025D869B18585F724CF4E80F340662D8C4BF6EBD49D2C3F84B9E2AD9EE067F2EFA8C5C3'O;

  const Ieee1609Dot2Data data_signer_cert := {
	protocolVersion := 3,
	content := {
		signedData := {
			hashId := sha256,
			tbsData := {
				payload := {
					data := {
						protocolVersion := 3,
						content := { unsecuredData := '010185000101200D69F5FF0201038080008003008100188106726F6F74434100000000001C4076F586000A01018001248002FFFF010200810081808082B508635B64345D0AC96EA586D58F07ACF83476C0AF8A2B95D1FE9CF341D96AFE80802662D8B62BD76DDA2FF971E0B9DC89314FF0BDCFB5C9449620D284D1F1DD8128E46BB852338118A866150F0FA69D8733F4A77FD6119B94B9917D43AA9022BBC0808480800300810070810774657374544C4D00000000001C1A3B7586000A83010282002101020B0102001600150B01010016820021010101010100010001028001228004456732118001238104032671218080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A16808051F06569167A9EDAFCBA8C87AE167CD3C84D8D5AC98EEFDD842F798998FF3A235A526F5513610563F9F214422DF7F971CB947B00210B0662D5EA946A64AD9DCD800300810070810774657374544C4D00000000001C1A3B7586000A83010282002101020B0102001600150B01010016820021010101010100010001028001228004456732118001238104032671218080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A1680802758B32076D0B239A0B272331A7FC7D5DC8D9FF6FBB6CE27EB06EA2C4367C4C05733316F5179FBDEBDF23B5AE458033B42DCEC5F59D2F1FD29706C71C0A2512B15687474703A2F2F6C6F63616C686F73743A3830383080808080030081007981077465737452434100000000001C1A3B7586000A83010282002101020B0102001600150B010100168200210101010101000100010280012280044567321180012381040326712101020081008100808251434D2BFF68CDF5EB0DF83E33196A2FBCD3A61B6BA188FA760BF7E566569CDB8080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A168080E26927CEADA6536F35208CE62D49AE31DAEA301817695CFE3CCDBBA819AFAAC0D1E774354C365546B69510FE9E5130FD9C9EE16CE19A07BEB9E3B7F7858A025B80030081007981077465737452434100000000001C1A3B7586000A83010282002101020B0102001600150B010100168200210101010101000100010280012280044567321180012381040326712101020081008100808251434D2BFF68CDF5EB0DF83E33196A2FBCD3A61B6BA188FA760BF7E566569CDB8080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A1680809A3AB569C50771A5566B3FDDB2329D9BA45AAFF42D8C7479527064411025D869B18585F724CF4E80F340662D8C4BF6EBD49D2C3F84B9E2AD9EE067F2EFA8C5C3'O } 
					},
					extDataHash := omit
				},
				headerInfo := {
					psid := 624,
					generationTime := 475259357096000,
					expiryTime := omit,
					generationLocation := omit,
					p2pcdLearningRequest := omit,
					missingCrlIdentifier := omit,
					encryptionKey := omit,
					inlineP2pcdRequest := omit,
					requestedCertificate := omit
				}
			},
			signer := {
				certificate := {
					{
						version := 3,
						type_ := explicit ,
						issuer := { self_ := sha256 },
						toBeSigned := {
							id := { name := "testTLM" },
							cracaId := '000000'O, crlSeries := 0,
							validityPeriod := { start_ := 471481205, duration := { years := 10 } },
							region := {
								identifiedRegion := {
									{
										countryAndSubregions := {
											country := 33,
											regionAndSubregions := { { region := 11, subregions := { 22, 21 } }, { region := 11, subregions := { 22 } } }
										}
									},
									{
										countryAndSubregions := {
											country := 33,
											regionAndSubregions := { { region := 1, subregions := { 1 } } }
										}
									}
								}
							},
							assuranceLevel := '00'O,
							appPermissions := { { psid := 34, ssp := { opaque := '45673211'O } }, { psid := 35, ssp := { bitmapSsp := '267121'O } } },
							certIssuePermissions := omit, certRequestPermissions := omit, canRequestRollover := omit, encryptionKey := omit,
							verifyKeyIndicator := {
								verificationKey := { ecdsaNistP256 := { compressed_y_0 := '6C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A16'O } }
							} 
						},
						signature_ := {
							ecdsaNistP256Signature := {
								rSig := { x_only := '51F06569167A9EDAFCBA8C87AE167CD3C84D8D5AC98EEFDD842F798998FF3A23'O },
								sSig := '5A526F5513610563F9F214422DF7F971CB947B00210B0662D5EA946A64AD9DCD'O
							}
						}
					}
				}
			},
			signature_ := {
				ecdsaNistP256Signature := {
					rSig := { x_only := 'E4B07C162E6953CBD2FDEFFA2E66AC7B6831C31B4EB3171947BCCDBD6534E045'O },
					sSig := '14EDC5EA06A9A647CC7FCC80B566A77982CB0CED5BDA231975A1A7284E78B355'O }
			}
		}
	}
  };
  

  const Ieee1609Dot2Data data_signer_hash := {
	protocolVersion := 3,
	content := {
		signedData := {
			hashId := sha256,
			tbsData := {
				payload := {
					data := {
						protocolVersion := 3,
						content := { unsecuredData := '010185000101200D69F5FF0201038080008003008100188106726F6F74434100000000001C4076F586000A01018001248002FFFF010200810081808082B508635B64345D0AC96EA586D58F07ACF83476C0AF8A2B95D1FE9CF341D96AFE80802662D8B62BD76DDA2FF971E0B9DC89314FF0BDCFB5C9449620D284D1F1DD8128E46BB852338118A866150F0FA69D8733F4A77FD6119B94B9917D43AA9022BBC0808480800300810070810774657374544C4D00000000001C1A3B7586000A83010282002101020B0102001600150B01010016820021010101010100010001028001228004456732118001238104032671218080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A16808051F06569167A9EDAFCBA8C87AE167CD3C84D8D5AC98EEFDD842F798998FF3A235A526F5513610563F9F214422DF7F971CB947B00210B0662D5EA946A64AD9DCD800300810070810774657374544C4D00000000001C1A3B7586000A83010282002101020B0102001600150B01010016820021010101010100010001028001228004456732118001238104032671218080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A1680802758B32076D0B239A0B272331A7FC7D5DC8D9FF6FBB6CE27EB06EA2C4367C4C05733316F5179FBDEBDF23B5AE458033B42DCEC5F59D2F1FD29706C71C0A2512B15687474703A2F2F6C6F63616C686F73743A3830383080808080030081007981077465737452434100000000001C1A3B7586000A83010282002101020B0102001600150B010100168200210101010101000100010280012280044567321180012381040326712101020081008100808251434D2BFF68CDF5EB0DF83E33196A2FBCD3A61B6BA188FA760BF7E566569CDB8080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A168080E26927CEADA6536F35208CE62D49AE31DAEA301817695CFE3CCDBBA819AFAAC0D1E774354C365546B69510FE9E5130FD9C9EE16CE19A07BEB9E3B7F7858A025B80030081007981077465737452434100000000001C1A3B7586000A83010282002101020B0102001600150B010100168200210101010101000100010280012280044567321180012381040326712101020081008100808251434D2BFF68CDF5EB0DF83E33196A2FBCD3A61B6BA188FA760BF7E566569CDB8080826C928A195ACA74A2294A7C1B80E8D3C45DD2FA681C268E8730859C70166B1A1680809A3AB569C50771A5566B3FDDB2329D9BA45AAFF42D8C7479527064411025D869B18585F724CF4E80F340662D8C4BF6EBD49D2C3F84B9E2AD9EE067F2EFA8C5C3'O } 
					},
					extDataHash := omit
				},
				headerInfo := {
					psid := 624,
					generationTime := 475259357096000,
					expiryTime := omit,
					generationLocation := omit,
					p2pcdLearningRequest := omit,
					missingCrlIdentifier := omit,
					encryptionKey := omit,
					inlineP2pcdRequest := omit,
					requestedCertificate := omit
				}
			},
			signer := {
				digest := '3132333435363738'O
			},
			signature_ := {
				ecdsaNistP256Signature := {
					rSig := { x_only := 'E4B07C162E6953CBD2FDEFFA2E66AC7B6831C31B4EB3171947BCCDBD6534E045'O },
					sSig := '14EDC5EA06A9A647CC7FCC80B566A77982CB0CED5BDA231975A1A7284E78B355'O }
			}
		}
	}
  };
   
   log("dec: encoded");
   dec_EtsiTs103097Data(encoded);
   log("dec: encoded_our");
   dec_EtsiTs103097Data(encoded_our);
   log("dec: encoded_our_bis");
   dec_EtsiTs103097Data(encoded_our_bis);
   log("dec: encoded_unsecured_data_out");
   dec_EtsiTs102941Data(encoded_unsecured_data_our);

   log("enc: data_signer_cert");          
   enc_EtsiTs103097Data(data_signer_cert);
   log("enc: data_signer_hash");
   enc_EtsiTs103097Data(data_signer_hash);

   log("dec: encoded_unsecured_data");
   dec_EtsiTs102941Data(encoded_unsecured_data);
}

testcase tc_EtsiTs103097Data() runs on Test_CT {
  const octetstring encoded :=
    '0381004003800F5468697320697320612042534D0D0A4001201112131415161718810101000300802122232425262728508118737963616D6F72652E696E742E69646E6F6D69632E636F6D616263004604E09A208400A983010380007C8001E4800348010200012000012681829192939495969798919293949596979891929394959697989192939495969798808231323334353637383132333435363738313233343536373831323334353637384142434445464748414243444546474841424344454647484142434445464748'O;

  const octetstring encoded_ko_with_missingCrlID :=
    '0381004003800F5468697320697320612042534D0D0A440120111213141516171800A5A5A50063810101000300802122232425262728508118737963616D6F72652E696E742E69646E6F6D69632E636F6D616263004604E09A208400A983010380007C8001E4800348010200012000012681829192939495969798919293949596979891929394959697989192939495969798808231323334353637383132333435363738313233343536373831323334353637384142434445464748414243444546474841424344454647484142434445464748'O;

  const EtsiTs103097Data data_ok := {
    protocolVersion := 3,
    content := {
      signedData := {
        hashId := sha256,
        tbsData := {
          payload := {
            data := {
              protocolVersion := 3,
              content := { unsecuredData := '5468697320697320612042534D0D0A'O }
            }
          },
          // headerInfo := { psid := 32, generationTime := 1230066625199609624, missingCrlIdentifier := { cracaId := 'A5A5A5'O, crlSeries := 99 } }
          headerInfo := { psid := 32, generationTime := 1230066625199609624 }
        },
        signer := {
          certificate := {
            {
              version := 3,
              type_ := explicit,
              issuer := { sha256AndDigest := '2122232425262728'O },
              toBeSigned := {
                id := { name := "sycamore.int.idnomic.com" },
                cracaId := '616263'O,
                crlSeries := 70,
                validityPeriod := { start_ := 81828384, duration := { hours := 169 } },
                region := { identifiedRegion := { { countryOnly := 124 }, { countryOnly := 484 }, { countryOnly := 840 } } },
                appPermissions := { { psid := 32}, { psid := 38} },
                verifyKeyIndicator := { reconstructionValue := { compressed_y_0 := '9192939495969798919293949596979891929394959697989192939495969798'O } }
              }
            }
          }
        },
        signature_ := {
          ecdsaNistP256Signature := {
            rSig := { compressed_y_0 := '3132333435363738313233343536373831323334353637383132333435363738'O},
            sSig := '4142434445464748414243444546474841424344454647484142434445464748'O
          }
        }
      }
    }
  };

  var EtsiTs103097Data data_ko := data_ok;
  data_ko.content.signedData.signer.certificate[0].toBeSigned.id := {
    linkageData := { iCert := 100, linkage_value := '313233343536373839'O, group_linkage_value := { jValue := '41424344'O, value_ := '515253545556575859'O } }
  };

  const EtsiTs103097Data decoded := {
    protocolVersion := 3,
    content := {
      signedData := {
        hashId := sha256,
        tbsData := {
          payload := {
            data := {
              protocolVersion := 3,
              content := { unsecuredData := '5468697320697320612042534D0D0A'O } 
            },
            extDataHash := omit
          },
          headerInfo := {
            psid := 32,
            generationTime := 1230066625199609624,
            expiryTime := omit,
            generationLocation := omit,
            p2pcdLearningRequest := omit,
            missingCrlIdentifier := omit,
            encryptionKey := omit,
            inlineP2pcdRequest := omit,
            requestedCertificate := omit
          }
        },
        signer := {
          certificate := { 
            {
              version := 3,
              type_ := explicit,
              issuer := { sha256AndDigest := '2122232425262728'O },
              toBeSigned := {
                id := { name := "sycamore.int.idnomic.com" },
                cracaId := '616263'O,
                crlSeries := 70,
                validityPeriod := { start_ := 81828384, duration := { hours := 169 } },
                region := {
                  identifiedRegion := {
                    { countryOnly := 124 },
                    { countryOnly := 484 },
                    { countryOnly := 840 }
                  }
                },
                assuranceLevel := omit,
                appPermissions := {
                  { psid := 32, ssp := omit },
                  { psid := 38, ssp := omit }
                },
                certIssuePermissions := omit,
                certRequestPermissions := omit,
                canRequestRollover := omit,
                encryptionKey := omit,
                verifyKeyIndicator := { reconstructionValue := { compressed_y_0 := '9192939495969798919293949596979891929394959697989192939495969798'O } } 
              },
              signature_ := omit
            }
          }
        },
        signature_ := {
          ecdsaNistP256Signature := {
            rSig := { compressed_y_0 := '3132333435363738313233343536373831323334353637383132333435363738'O },
            sSig := '4142434445464748414243444546474841424344454647484142434445464748'O 
          }
        }
      }
    }
  };

  if (enc_EtsiTs103097Data(data_ok) == encoded) {setverdict(pass);} else {setverdict(fail);}
  if (enc_EtsiTs103097Data(data_ko) == ''O) {setverdict(pass);} else {setverdict(fail);}
  if (dec_EtsiTs103097Data(encoded) == decoded) {setverdict(pass);} else {setverdict(fail);}

  @try {
    dec_EtsiTs103097Data(encoded_ko_with_missingCrlID);
    setverdict(fail, "exception was expected");
  }
  @catch(e) {
    setverdict(pass, "exception catched", e);
  }
}

testcase tc_EtsiTs103097DataEncodedBis() runs on Test_CT {
  const octetstring encoded :=
    '3082021C060C2B0601040181AD5A040101030482020A30820206305B30590408C716D746CB440DE5044D304B30250A010302200B01F9165385C73BEB44EA874EF834A5AB2BC29411D98AB243BB3E4F44D8D1160410B4AEB0870017823F9655B5A0BBC61F1E04100000DFCD9E3D762CC2E6EB9CE95B834B060C2B0601040181AD5A04010102301E060C2B0601040181AD5A04010201300E040C4BE5F70E8F8105811EFE8E6A0482017777A081D455F6ABB77338382459637F9066C7F440E7FE30D2391499785B894D94E8A74B7A676D8556AB5E9E4FB0E0FEAA4CD91F2AAA5C2B44384B71E7844E6259C512F036AB3B0956A476B9C207E744D505E0335AD720062A9CF459FB943B4B08F5E29282EC312470003F34B4E7C659797883CFB7B9480AFD8CDCD4A47A330664013DF50ED4BAA8F60CAAD6882847A93D16106D40952B4F578C74B8FC6AC0271C6D160A13D4AA1AB759DC379899837BE65DAA0F09F55A6EB763467AAB07A092C80D4F2AF70161290F760C8AA0FED941770C63082098CBB34070CF6C5C05D8763705A5B489D1065FEA6CF6688084D7BDF6F85B9568451F4B5BA49AA8B275DA9F636F2A2C8748A3ACCB1710F0AF2E9EFA7FD7046D01BC1012C176BFD4875A8D536660B0E2A73981CC10282A3E97310ABAEEEF9E504B6D05E42F0015E6B8739D2A5FADFC25C3A15CF8FAF230E87EFDBBEA7ECD50B26A1048526250B841950708E027556F2A07BCA941A2DC194BD642F19BBA026C589EE70E9D'O;

  dec_EtsiTs103097DataEncryptedBis(encoded);
}

//*********************************************
// CONTROL PART
//*********************************************

control {
  // execute(tc_EtsiTs103097Data());
  // execute(tc_EtsiTs103097DataEncodedBis());
  execute(tc_Ieee1609Dot2Data());
}

<RESULT>

Overall verdict: pass

<END_TC>

